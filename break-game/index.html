<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æ‰“ç –å—</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow: hidden;
      touch-action: none;
    }
    h1 { color: #fff; font-size: 1.2em; margin-bottom: 10px; }
    #gameContainer {
      position: relative;
      width: 95%;
      max-width: 400px;
    }
    canvas {
      width: 100%;
      background: #000;
      border-radius: 8px;
      display: block;
    }
    #startBtn {
      margin-top: 15px;
      padding: 12px 30px;
      font-size: 1.1em;
      background: #4ecdc4;
      border: none;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
    }
    #info {
      color: #fff;
      margin-top: 10px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>ğŸ§± æ‰“ç –å— Breakout</h1>
  <div id="gameContainer">
    <canvas id="c"></canvas>
  </div>
  <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
  <p id="info">æ‰‹æœºï¼šæ»‘åŠ¨å±å¹• | ç”µè„‘ï¼šé¼ æ ‡/é”®ç›˜</p>

  <script>
  (function() {
    var canvas = document.getElementById('c');
    var ctx = canvas.getContext('2d');
    var startBtn = document.getElementById('startBtn');
    var info = document.getElementById('info');

    // è®¾ç½®ç”»å¸ƒå¤§å°
    function setSize() {
      var w = Math.min(window.innerWidth * 0.95, 400);
      canvas.width = w;
      canvas.height = w * 1.2;
    }
    setSize();
    window.addEventListener('resize', setSize);

    // æ¸¸æˆçŠ¶æ€
    var running = false;
    var score = 0;
    var lives = 3;

    // æ¸¸æˆå¯¹è±¡
    var paddle = { w: 80, h: 15, x: 0, y: 0, color: '#4ecdc4' };
    var ball = { x: 0, y: 0, r: 8, dx: 3, dy: -3, color: '#fff' };
    var bricks = [];
    var brickRows = 5;
    var brickCols = 7;
    var brickW = 0;
    var brickH = 20;
    var brickGap = 5;

    function init() {
      paddle.w = canvas.width * 0.3;
      paddle.h = 15;
      paddle.y = canvas.height - 40;
      paddle.x = canvas.width / 2 - paddle.w / 2;

      ball.x = canvas.width / 2;
      ball.y = paddle.y - ball.r - 5;
      ball.dx = 3;
      ball.dy = -3;

      bricks = [];
      brickW = (canvas.width - 20 - brickGap * (brickCols - 1)) / brickCols;
      for (var r = 0; r < brickRows; r++) {
        for (var c = 0; c < brickCols; c++) {
          bricks.push({
            x: 10 + c * (brickW + brickGap),
            y: 50 + r * (brickH + brickGap),
            alive: true,
            color: r < 2 ? '#ff6b6b' : '#45b7d1'
          });
        }
      }
    }

    function draw() {
      // æ¸…ç©ºç”»å¸ƒ
      ctx.fillStyle = '#0a0a1a';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // ç”»ç –å—
      for (var i = 0; i < bricks.length; i++) {
        var b = bricks[i];
        if (!b.alive) continue;
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, b.y, brickW, brickH);
      }

      // ç”»æŒ¡æ¿
      ctx.fillStyle = paddle.color;
      ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

      // ç”»çƒ
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
      ctx.fillStyle = ball.color;
      ctx.fill();

      // æ˜¾ç¤ºåˆ†æ•°
      ctx.fillStyle = '#fff';
      ctx.font = '16px Arial';
      ctx.fillText('åˆ†æ•°: ' + score, 10, 25);
      ctx.fillText('ç”Ÿå‘½: ' + lives, canvas.width - 80, 25);
    }

    function update() {
      if (!running) return;

      // ç§»åŠ¨çƒ
      ball.x += ball.dx;
      ball.y += ball.dy;

      // å¢™å£ç¢°æ’
      if (ball.x - ball.r < 0 || ball.x + ball.r > canvas.width) {
        ball.dx = -ball.dx;
      }
      if (ball.y - ball.r < 0) {
        ball.dy = -ball.dy;
      }

      // æŒ¡æ¿ç¢°æ’
      if (ball.y + ball.r > paddle.y &&
          ball.y - ball.r < paddle.y + paddle.h &&
          ball.x > paddle.x &&
          ball.x < paddle.x + paddle.w) {
        ball.dy = -Math.abs(ball.dy);
        var hitPos = (ball.x - paddle.x) / paddle.w;
        ball.dx = (hitPos - 0.5) * 6;
      }

      // ç –å—ç¢°æ’
      for (var i = 0; i < bricks.length; i++) {
        var b = bricks[i];
        if (!b.alive) continue;
        if (ball.x + ball.r > b.x && ball.x - ball.r < b.x + brickW &&
            ball.y + ball.r > b.y && ball.y - ball.r < b.y + brickH) {
          ball.dy = -ball.dy;
          b.alive = false;
          score += 10;
          break;
        }
      }

      // çƒæ‰è½
      if (ball.y - ball.r > canvas.height) {
        lives--;
        if (lives <= 0) {
          running = false;
          startBtn.textContent = 'é‡æ–°å¼€å§‹';
          info.textContent = 'æ¸¸æˆç»“æŸï¼å¾—åˆ†: ' + score;
        } else {
          ball.x = canvas.width / 2;
          ball.y = paddle.y - ball.r - 5;
          ball.dx = 3;
          ball.dy = -3;
        }
      }

      // èƒœåˆ©
      if (bricks.every(function(b) { return !b.alive; })) {
        running = false;
        startBtn.textContent = 'å†æ¥ä¸€å±€';
        info.textContent = 'æ­å–œé€šå…³ï¼å¾—åˆ†: ' + score;
      }
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // å¼€å§‹æŒ‰é’®
    startBtn.addEventListener('click', function() {
      if (lives <= 0 || bricks.every(function(b) { return !b.alive; })) {
        score = 0;
        lives = 3;
      }
      init();
      running = true;
      startBtn.textContent = 'è¿›è¡Œä¸­...';
      info.textContent = 'æ‰‹æœºï¼šæ»‘åŠ¨ | ç”µè„‘ï¼šé¼ æ ‡ç§»åŠ¨';
    });

    // é¼ æ ‡ç§»åŠ¨
    canvas.addEventListener('mousemove', function(e) {
      var rect = canvas.getBoundingClientRect();
      var scaleX = canvas.width / rect.width;
      var mouseX = (e.clientX - rect.left) * scaleX;
      paddle.x = mouseX - paddle.w / 2;
      paddle.x = Math.max(0, Math.min(canvas.width - paddle.w, paddle.x));
    });

    // è§¦æ‘¸æ»‘åŠ¨
    canvas.addEventListener('touchmove', function(e) {
      e.preventDefault();
      var rect = canvas.getBoundingClientRect();
      var scaleX = canvas.width / rect.width;
      var touchX = (e.touches[0].clientX - rect.left) * scaleX;
      paddle.x = touchX - paddle.w / 2;
      paddle.x = Math.max(0, Math.min(canvas.width - paddle.w, paddle.x));
    }, { passive: false });

    // è§¦æ‘¸ç‚¹å‡»å¼€å§‹
    canvas.addEventListener('touchstart', function(e) {
      e.preventDefault();
      if (!running && lives > 0 && !bricks.every(function(b) { return !b.alive; })) {
        running = true;
        startBtn.textContent = 'è¿›è¡Œä¸­...';
        info.textContent = 'æ‰‹æœºï¼šæ»‘åŠ¨ | ç”µè„‘ï¼šé¼ æ ‡ç§»åŠ¨';
      }
    }, { passive: false });

    // é”®ç›˜æ§åˆ¶
    document.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowLeft' || e.key === 'a') {
        paddle.x -= 20;
        paddle.x = Math.max(0, paddle.x);
      }
      if (e.key === 'ArrowRight' || e.key === 'd') {
        paddle.x += 20;
        paddle.x = Math.min(canvas.width - paddle.w, paddle.x);
      }
      if (e.code === 'Space') {
        if (!running && lives > 0 && !bricks.every(function(b) { return !b.alive; })) {
          running = true;
          startBtn.textContent = 'è¿›è¡Œä¸­...';
        }
      }
    });

    // åˆå§‹åŒ–å¹¶å¼€å§‹å¾ªç¯
    init();
    loop();
  })();
  </script>
</body>
</html>
