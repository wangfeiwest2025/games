<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>贪吃蛇</title>
<style>
* { margin: 0; padding: 0; }
html, body { width: 100%; height: 100%; overflow: hidden; }
body {
  font-family: Arial, sans-serif;
  background: #1a1a2e;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  touch-action: none;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
}
#gameArea {
  position: relative;
  width: 300px;
  height: 300px;
  background: #0a0a1a;
  border: 2px solid #4ecdc4;
  border-radius: 8px;
}
canvas { display: block; }
#btn {
  margin-top: 20px;
  padding: 15px 50px;
  font-size: 18px;
  background: #4ecdc4;
  border: none;
  border-radius: 25px;
  color: white;
  cursor: pointer;
}
#msg { color: #aaa; margin-top: 10px; font-size: 14px; }
</style>
</head>
<body>
<div id="gameArea"><canvas id="c" width="300" height="300"></canvas></div>
<button id="btn" onclick="startGame()">开始游戏</button>
<p id="msg">点击屏幕左右区域控制方向</p>
<script>
var c = document.getElementById('c');
var ctx = c.getContext('2d');
var btn = document.getElementById('btn');
var msg = document.getElementById('msg');
var running = false;
var snake = [], food = {}, dir = {x:1,y:0}, score = 0;
var timer = null;

function init() {
  snake = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
  dir = {x:1,y:0};
  score = 0;
  placeFood();
  draw();
  btn.innerText = '开始游戏';
  msg.innerText = '点击屏幕左右区域控制方向';
}

function placeFood() {
  var good = false;
  while(!good) {
    food = {x:Math.floor(Math.random()*15),y:Math.floor(Math.random()*15)};
    good = true;
    for(var i=0;i<snake.length;i++) {
      if(snake[i].x==food.x && snake[i].y==food.y) good=false;
    }
  }
}

function draw() {
  ctx.fillStyle = '#0a0a1a';
  ctx.fillRect(0,0,300,300);
  
  ctx.fillStyle = '#4ecdc4';
  for(var i=0;i<snake.length;i++) {
    ctx.fillRect(snake[i].x*20+1, snake[i].y*20+1, 18, 18);
  }
  
  ctx.fillStyle = '#ff6b6b';
  ctx.fillRect(food.x*20+2, food.y*20+2, 16, 16);
}

function update() {
  if(!running) return;
  
  var head = {x:snake[0].x+dir.x, y:snake[0].y+dir.y};
  
  if(head.x<0 || head.x>=15 || head.y<0 || head.y>=15 || 
     snake.some(function(s){return s.x==head.x && s.y==head.y})) {
    gameOver();
    return;
  }
  
  snake.unshift(head);
  if(head.x==food.x && head.y==food.y) {
    score+=10;
    placeFood();
  } else {
    snake.pop();
  }
  
  draw();
  timer = setTimeout(update, 150);
}

function startGame() {
  if(running) return;
  running = true;
  init();
  update();
  btn.innerText = '游戏中...';
  btn.disabled = true;
}

function gameOver() {
  running = false;
  if(timer) clearTimeout(timer);
  btn.disabled = false;
  btn.innerText = '重新开始';
  msg.innerText = '游戏结束! 得分: ' + score;
  
  ctx.fillStyle = 'rgba(0,0,0,0.7)';
  ctx.fillRect(0,0,300,300);
  ctx.fillStyle = 'white';
  ctx.font = '24px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('游戏结束!',150,140);
  ctx.font = '16px Arial';
  ctx.fillText('得分: '+score,150,170);
}

// 触摸控制 - 最简单可靠的方式
var touchStartX = 0;
document.addEventListener('touchstart',function(e){
  touchStartX = e.touches[0].clientX;
},false);

document.addEventListener('touchend',function(e){
  if(!running) {
    startGame();
    return;
  }
  var touchEndX = e.changedTouches[0].clientX;
  var diff = touchEndX - touchStartX;
  if(Math.abs(diff)>10) {
    if(diff>0 && dir.x!==-1) dir={x:1,y:0};
    else if(diff<0 && dir.x!==1) dir={x:-1,y:0};
  }
},false);

// 点击控制
c.addEventListener('click',function(e){
  if(!running) {
    startGame();
    return;
  }
  var rect = c.getBoundingClientRect();
  var x = e.clientX - rect.left;
  if(x<100 && dir.x!==-1) dir={x:1,y:0};
  else if(x>200 && dir.x!==1) dir={x:-1,y:0};
});

// 键盘控制
document.addEventListener('keydown',function(e){
  if(e.key=='ArrowLeft' && dir.x!==1) dir={x:-1,y:0};
  if(e.key=='ArrowRight' && dir.x!==-1) dir={x:1,y:0};
  if(e.key=='ArrowUp' && dir.y!==1) dir={x:0,y:-1};
  if(e.key=='ArrowDown' && dir.y!==-1) dir={x:0,y:1};
});

init();
</script>
</body>
</html>
