<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>è´ªåƒè›‡ Snake</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; touch-action: none; }
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    h1 { color: #fff; font-size: 1.2em; margin-bottom: 10px; }
    #info { color: #aaa; font-size: 0.8em; margin-bottom: 10px; }
    #gameContainer {
      position: relative;
      width: 95%;
      max-width: 350px;
    }
    canvas {
      width: 100%;
      background: #0a0a1a;
      border-radius: 8px;
      display: block;
    }
    #startBtn {
      margin-top: 15px;
      padding: 15px 40px;
      font-size: 1.1em;
      background: #4ecdc4;
      border: none;
      border-radius: 25px;
      color: #fff;
      cursor: pointer;
    }
    #startBtn:active { background: #3dbdb5; }
    #status { color: #fff; margin-top: 10px; font-size: 0.9em; }
  </style>
</head>
<body>
  <h1>ğŸ è´ªåƒè›‡ Snake</h1>
  <p id="info">æ‰‹æœºï¼šç‚¹å‡»å·¦/å³ä¾§ | ç”µè„‘ï¼šæ–¹å‘é”®æˆ–é¼ æ ‡</p>
  <div id="gameContainer">
    <canvas id="c"></canvas>
  </div>
  <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
  <p id="status">å¾—åˆ†: 0</p>

  <script>
  (function() {
    var canvas = document.getElementById('c');
    var ctx = canvas.getContext('2d');
    var startBtn = document.getElementById('startBtn');
    var status = document.getElementById('status');

    function setSize() {
      var w = Math.min(window.innerWidth * 0.95, 350);
      canvas.width = w;
      canvas.height = w;
    }
    setSize();
    window.addEventListener('resize', setSize);

    var running = false;
    var score = 0;
    var dir = {x: 1, y: 0};
    var snake = [];
    var food = {x: 0, y: 0};
    var gameLoop = null;

    function init() {
      var cx = Math.floor(canvas.width / 20);
      var cy = Math.floor(canvas.height / 20);
      snake = [
        {x: cx, y: cy},
        {x: cx-1, y: cy},
        {x: cx-2, y: cy}
      ];
      dir = {x: 1, y: 0};
      placeFood();
      score = 0;
      status.textContent = 'å¾—åˆ†: ' + score;
      startBtn.textContent = 'é‡æ–°å¼€å§‹';
    }

    function placeFood() {
      var cols = Math.floor(canvas.width / 20);
      var rows = Math.floor(canvas.height / 20);
      var valid = false;
      while (!valid) {
        food.x = Math.floor(Math.random() * cols);
        food.y = Math.floor(Math.random() * rows);
        valid = true;
        for (var i = 0; i < snake.length; i++) {
          if (snake[i].x === food.x && snake[i].y === food.y) {
            valid = false;
            break;
          }
        }
      }
    }

    function update() {
      if (!running) return;

      var head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
      var cols = Math.floor(canvas.width / 20);
      var rows = Math.floor(canvas.height / 20);

      // æ’å¢™
      if (head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows) {
        gameOver();
        return;
      }

      // æ’è‡ªå·±
      for (var i = 0; i < snake.length; i++) {
        if (head.x === snake[i].x && head.y === snake[i].y) {
          gameOver();
          return;
        }
      }

      snake.unshift(head);

      // åƒåˆ°é£Ÿç‰©
      if (head.x === food.x && head.y === food.y) {
        score += 10;
        status.textContent = 'å¾—åˆ†: ' + score;
        placeFood();
      } else {
        snake.pop();
      }
    }

    function draw() {
      ctx.fillStyle = '#0a0a1a';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // ç”»è›‡
      ctx.fillStyle = '#4ecdc4';
      for (var i = 0; i < snake.length; i++) {
        var s = snake[i];
        ctx.fillRect(s.x * 20 + 1, s.y * 20 + 1, 18, 18);
      }

      // ç”»é£Ÿç‰©
      ctx.fillStyle = '#ff6b6b';
      ctx.fillRect(food.x * 20 + 2, food.y * 20 + 2, 16, 16);
    }

    function loop() {
      update();
      draw();
      if (running) {
        gameLoop = setTimeout(loop, 120);
      }
    }

    function startGame() {
      if (running) return;
      running = true;
      init();
      loop();
      startBtn.textContent = 'æ¸¸æˆä¸­...';
      startBtn.disabled = true;
    }

    function gameOver() {
      running = false;
      if (gameLoop) clearTimeout(gameLoop);
      startBtn.disabled = false;
      startBtn.textContent = 'é‡æ–°å¼€å§‹';
      
      ctx.fillStyle = 'rgba(0,0,0,0.7)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#fff';
      ctx.font = 'bold 24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('æ¸¸æˆç»“æŸ!', canvas.width/2, canvas.height/2);
      ctx.font = '16px Arial';
      ctx.fillText('å¾—åˆ†: ' + score, canvas.width/2, canvas.height/2 + 30);
    }

    // å¼€å§‹æŒ‰é’®
    startBtn.addEventListener('click', function() {
      if (!running) {
        startGame();
      }
    });

    // é”®ç›˜æ§åˆ¶
    document.addEventListener('keydown', function(e) {
      switch(e.key) {
        case 'ArrowLeft': if (dir.x !== 1) dir = {x:-1, y:0}; break;
        case 'ArrowRight': if (dir.x !== -1) dir = {x:1, y:0}; break;
        case 'ArrowUp': if (dir.y !== 1) dir = {x:0, y:-1}; break;
        case 'ArrowDown': if (dir.y !== -1) dir = {x:0, y:1}; break;
      }
    });

    // é¼ æ ‡æ§åˆ¶
    canvas.addEventListener('mousemove', function(e) {
      if (!running) return;
      var rect = canvas.getBoundingClientRect();
      var mx = e.clientX - rect.left;
      var wx = canvas.width / 3;
      if (mx < wx && dir.x !== 1) dir = {x:-1, y:0};
      else if (mx > wx * 2 && dir.x !== -1) dir = {x:1, y:0};
    });

    // è§¦æ‘¸æ§åˆ¶ - ç®€å•å¯é 
    var touchStartX = 0;
    canvas.addEventListener('touchstart', function(e) {
      e.preventDefault();
      touchStartX = e.touches[0].clientX;
    }, {passive: false});

    canvas.addEventListener('touchend', function(e) {
      e.preventDefault();
      if (!running) {
        startGame();
        return;
      }
      var touchEndX = e.changedTouches[0].clientX;
      var diff = touchEndX - touchStartX;
      if (Math.abs(diff) > 20) {
        if (diff > 0 && dir.x !== -1) dir = {x:1, y:0};
        else if (diff < 0 && dir.x !== 1) dir = {x:-1, y:0};
      }
    }, {passive: false});

    // ç‚¹å‡»æ§åˆ¶ - æ›´ç®€å•
    canvas.addEventListener('click', function(e) {
      if (!running) {
        startGame();
        return;
      }
      var rect = canvas.getBoundingClientRect();
      var x = e.clientX - rect.left;
      var center = canvas.width / 2;
      if (x < center - 30 && dir.x !== 1) dir = {x:-1, y:0};
      else if (x > center + 30 && dir.x !== -1) dir = {x:1, y:0};
    });

    // åˆå§‹åŒ–
    init();
    draw();
  })();
  </script>
</body>
</html>
